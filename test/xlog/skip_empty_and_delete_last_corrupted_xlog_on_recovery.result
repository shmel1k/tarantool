#!/usr/bin/env tarantool
---
...
env = require('test_run')
---
...
test_run = env.new()
---
...
box.cfg{}
---
...
test_run:cmd('create server test with script = "xlog/force_recovery.lua"')
---
- true
...
test_run:cmd("start server test")
---
- true
...
test_run:cmd("switch test")
---
- true
...
box.space._schema:replace({'test'})
---
- ['test']
...
test_run:cmd("switch default")
---
- true
...
test_run:cmd("stop server test")
---
- true
...
test_run:cmd("start server test")
---
- true
...
test_run:cmd("switch test")
---
- true
...
box.space._schema:replace({'lost'})
---
- ['lost']
...
test_run:cmd("switch default")
---
- true
...
test_run:cmd("stop server test")
---
- true
...
test_run:cmd("start server test")
---
- true
...
test_run:cmd("switch test")
---
- true
...
box.space._schema:replace({'tost'})
---
- ['tost']
...
test_run:cmd("switch default")
---
- true
...
test_run:cmd("stop server test")
---
- true
...
os.execute("rm force_recovery/00000000000000000001.xlog")
---
- 0
...
os.execute("touch force_recovery/00000000000000000001.xlog")
---
- 0
...
test_run:cmd("start server test")
---
- true
...
test_run:cmd("switch test")
---
- true
...
box.space._schema:replace({'last'})
---
- ['last']
...
test_run:cmd("switch default")
---
- true
...
test_run:cmd("stop server test")
---
- true
...
os.execute("rm force_recovery/00000000000000000003.xlog")
---
- 0
...
os.execute("touch force_recovery/00000000000000000003.xlog")
---
- 0
...
test_run:cmd("start server test")
---
- true
...
test_run:cmd("switch test")
---
- true
...
box.space._schema:replace({'list'})
---
- ['list']
...
